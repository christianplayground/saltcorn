

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saltcorn saltcorn-data/models/table.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="jsdoc.styles.css">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    API Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
                <div class="search-wrapper">
                    <input id="search" type="text" placeholder="Search docs..." class="input">
                </div>
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Classes</h3><ul><li><a href="Role_Role.html">Role</a></li></ul><h3>Global</h3><ul><li><a href="global.html#connectObj">connectObj</a></li><li><a href="global.html#dbModule">dbModule</a></li><li><a href="global.html#getTenantSchemaPrefix">getTenantSchemaPrefix</a></li><li><a href="global.html#initDbModule">initDbModule</a></li><li><a href="global.html#isSQLite">isSQLite</a></li></ul></div><div class="category"><h2>db-common</h2><h3>Modules</h3><ul><li><a href="module-db-common_index.html">db-common/index</a></li><li><a href="module-internal.html">internal</a></li><li><a href="module-multi-tenant.html">multi-tenant</a></li><li><a href="module-single-tenant.html">single-tenant</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-db-common_index-db-common_overview.html">db-common_overview</a></li></ul></div><div class="category"><h2>postgres</h2><h3>Modules</h3><ul><li><a href="module-postgres.html">postgres</a></li><li><a href="module-postgres_index.html">postgres/index</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-postgres_index-postgres_overview.html">postgres_overview</a></li></ul></div><div class="category"><h2>saltcorn-base-plugin</h2><h3>Modules</h3><ul><li><a href="module-saltcorn-base-plugin_index.html">saltcorn-base-plugin/index</a></li></ul></div><div class="category"><h2>saltcorn-builder</h2><h3>Modules / components</h3><ul><li><a href="module-components_Builder.html">components/Builder</a></li><li><a href="module-components_context.html">components/context</a></li><li><a href="module-components_Library.html">components/Library</a></li><li><a href="module-components_preview_context.html">components/preview_context</a></li><li><a href="module-components_RenderNode.html">components/RenderNode</a></li><li><a href="module-components_storage.html">components/storage</a></li><li><a href="module-components_Toolbox.html">components/Toolbox</a></li></ul><h3>Modules / components / elements</h3><ul><li><a href="module-components_elements_Action.html">components/elements/Action</a></li><li><a href="module-components_elements_Aggregation.html">components/elements/Aggregation</a></li><li><a href="module-components_elements_BoxModelEditor.html">components/elements/BoxModelEditor</a></li><li><a href="module-components_elements_Card.html">components/elements/Card</a></li><li><a href="module-components_elements_Column.html">components/elements/Column</a></li><li><a href="module-components_elements_Columns.html">components/elements/Columns</a></li><li><a href="module-components_elements_Container.html">components/elements/Container</a></li><li><a href="module-components_elements_DropDownFilter.html">components/elements/DropDownFilter</a></li><li><a href="module-components_elements_Empty.html">components/elements/Empty</a></li><li><a href="module-components_elements_Field.html">components/elements/Field</a></li><li><a href="module-components_elements_HTMLCode.html">components/elements/HTMLCode</a></li><li><a href="module-components_elements_Image.html">components/elements/Image</a></li><li><a href="module-components_elements_JoinField.html">components/elements/JoinField</a></li><li><a href="module-components_elements_LineBreak.html">components/elements/LineBreak</a></li><li><a href="module-components_elements_Link.html">components/elements/Link</a></li><li><a href="module-components_elements_SearchBar.html">components/elements/SearchBar</a></li><li><a href="module-components_elements_Tabs.html">components/elements/Tabs</a></li><li><a href="module-components_elements_Text.html">components/elements/Text</a></li><li><a href="module-components_elements_ToggleFilter.html">components/elements/ToggleFilter</a></li><li><a href="module-components_elements_utils.html">components/elements/utils</a></li><li><a href="module-components_elements_View.html">components/elements/View</a></li><li><a href="module-components_elements_ViewLink.html">components/elements/ViewLink</a></li></ul><h3>Modules</h3><ul><li><a href="module-components_elements_faicons.html">components/elements/faicons</a></li><li><a href="module-saltcorn-builder_index.html">saltcorn-builder/index</a></li></ul><h3>Namespaces / components</h3><ul><li><a href="module-components_Builder-Builder.html">Builder</a></li><li><a href="module-components_Builder-HistoryPanel.html">HistoryPanel</a></li><li><a href="module-components_Builder-NextButton.html">NextButton</a></li><li><a href="module-components_Builder-SaveButton.html">SaveButton</a></li><li><a href="module-components_Builder-SettingsPanel.html">SettingsPanel</a></li><li><a href="module-components_Builder-ViewPageLink.html">ViewPageLink</a></li><li><a href="module-components_elements_Action-Action.html">Action</a></li><li><a href="module-components_elements_Action-ActionSettings.html">ActionSettings</a></li><li><a href="module-components_elements_Aggregation-Aggregation.html">Aggregation</a></li><li><a href="module-components_elements_Aggregation-AggregationSettings.html">AggregationSettings</a></li><li><a href="module-components_elements_BoxModelEditor-BoxModelEditor.html">BoxModelEditor</a></li><li><a href="module-components_elements_Card-Card.html">Card</a></li><li><a href="module-components_elements_Card-CardSettings.html">CardSettings</a></li><li><a href="module-components_elements_Columns-Columns.html">Columns</a></li><li><a href="module-components_elements_Columns-ColumnsSettings.html">ColumnsSettings</a></li><li><a href="module-components_elements_Column-Column.html">Column</a></li><li><a href="module-components_elements_Column-ColumnSettings.html">ColumnSettings</a></li><li><a href="module-components_elements_Container-Container.html">Container</a></li><li><a href="module-components_elements_Container-ContainerSettings.html">ContainerSettings</a></li><li><a href="module-components_elements_DropDownFilter-DropDownFilter.html">DropDownFilter</a></li><li><a href="module-components_elements_DropDownFilter-DropDownFilterSettings.html">DropDownFilterSettings</a></li><li><a href="module-components_elements_Empty-Empty.html">Empty</a></li><li><a href="module-components_elements_Field-Field.html">Field</a></li><li><a href="module-components_elements_Field-FieldSettings.html">FieldSettings</a></li><li><a href="module-components_elements_HTMLCode-HTMLCode.html">HTMLCode</a></li><li><a href="module-components_elements_Image-Image.html">Image</a></li><li><a href="module-components_elements_Image-ImageSettings.html">ImageSettings</a></li><li><a href="module-components_elements_JoinField-JoinField.html">JoinField</a></li><li><a href="module-components_elements_JoinField-JoinFieldSettings.html">JoinFieldSettings</a></li><li><a href="module-components_elements_LineBreak-LineBreak.html">LineBreak</a></li><li><a href="module-components_elements_Link-Link.html">Link</a></li><li><a href="module-components_elements_Link-LinkSettings.html">LinkSettings</a></li><li><a href="module-components_elements_SearchBar-SearchBar.html">SearchBar</a></li><li><a href="module-components_elements_SearchBar-SearchBarSettings.html">SearchBarSettings</a></li><li><a href="module-components_elements_Tabs-Tabs.html">Tabs</a></li><li><a href="module-components_elements_Tabs-TabsSettings.html">TabsSettings</a></li><li><a href="module-components_elements_Text-Text.html">Text</a></li><li><a href="module-components_elements_Text-TextSettings.html">TextSettings</a></li><li><a href="module-components_elements_ToggleFilter-ToggleFilter.html">ToggleFilter</a></li><li><a href="module-components_elements_ToggleFilter-ToggleFilterSettings.html">ToggleFilterSettings</a></li><li><a href="module-components_elements_ViewLink-ViewLink.html">ViewLink</a></li><li><a href="module-components_elements_ViewLink-ViewLinkSettings.html">ViewLinkSettings</a></li><li><a href="module-components_elements_View-View.html">View</a></li><li><a href="module-components_elements_View-ViewSettings.html">ViewSettings</a></li><li><a href="module-components_Library-InitNewElement.html">InitNewElement</a></li><li><a href="module-components_Library-Library.html">Library</a></li><li><a href="module-components_Library-LibraryElem.html">LibraryElem</a></li><li><a href="module-components_RenderNode-RenderNode.html">RenderNode</a></li><li><a href="module-components_storage-craftToSaltcorn.html">craftToSaltcorn</a></li><li><a href="module-components_storage-layoutToNodes.html">layoutToNodes</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-components_elements_faicons-faicons%2520_%2520all.html">faicons / all</a></li><li><a href="module-saltcorn-builder_index-saltcorn-builder_overview.html">saltcorn-builder_overview</a></li><li><a href="module-saltcorn-builder_index-saltcorn-builder_overview.saltcorn-builder_overview_elements.html">saltcorn-builder_overview/elements</a></li></ul><h3>Namespaces / components / elements / utils</h3><ul><li><a href="module-components_elements_utils-Accordion.html">Accordion</a></li><li><a href="module-components_elements_utils-BlockSetting.html">BlockSetting</a></li><li><a href="module-components_elements_utils-ButtonOrLinkSettingsRows.html">ButtonOrLinkSettingsRows</a></li><li><a href="module-components_elements_utils-ColorInput.html">ColorInput</a></li><li><a href="module-components_elements_utils-ConfigField.html">ConfigField</a></li><li><a href="module-components_elements_utils-ConfigForm.html">ConfigForm</a></li><li><a href="module-components_elements_utils-MinRoleSetting.html">MinRoleSetting</a></li><li><a href="module-components_elements_utils-MinRoleSettingRow.html">MinRoleSettingRow</a></li><li><a href="module-components_elements_utils-OrFormula.html">OrFormula</a></li><li><a href="module-components_elements_utils-SelectUnits.html">SelectUnits</a></li><li><a href="module-components_elements_utils-SettingsFromFields.html">SettingsFromFields</a></li><li><a href="module-components_elements_utils-SettingsRow.html">SettingsRow</a></li><li><a href="module-components_elements_utils-SettingsSectionHeaderRow.html">SettingsSectionHeaderRow</a></li><li><a href="module-components_elements_utils-TextStyleRow.html">TextStyleRow</a></li><li><a href="module-components_elements_utils-TextStyleSelect.html">TextStyleSelect</a></li><li><a href="module-components_elements_utils-TextStyleSetting.html">TextStyleSetting</a></li></ul><h3>Namespaces / components / Toolbox</h3><ul><li><a href="module-components_Toolbox-ActionElem.html">ActionElem</a></li><li><a href="module-components_Toolbox-AggregationElem.html">AggregationElem</a></li><li><a href="module-components_Toolbox-CardElem.html">CardElem</a></li><li><a href="module-components_Toolbox-ColumnsElem.html">ColumnsElem</a></li><li><a href="module-components_Toolbox-ContainerElem.html">ContainerElem</a></li><li><a href="module-components_Toolbox-DropDownFilterElem.html">DropDownFilterElem</a></li><li><a href="module-components_Toolbox-FieldElem.html">FieldElem</a></li><li><a href="module-components_Toolbox-HTMLElem.html">HTMLElem</a></li><li><a href="module-components_Toolbox-ImageElem.html">ImageElem</a></li><li><a href="module-components_Toolbox-JoinFieldElem.html">JoinFieldElem</a></li><li><a href="module-components_Toolbox-LineBreakElem.html">LineBreakElem</a></li><li><a href="module-components_Toolbox-LinkElem.html">LinkElem</a></li><li><a href="module-components_Toolbox-SearchElem.html">SearchElem</a></li><li><a href="module-components_Toolbox-TabsElem.html">TabsElem</a></li><li><a href="module-components_Toolbox-TextElem.html">TextElem</a></li><li><a href="module-components_Toolbox-ToggleFilterElem.html">ToggleFilterElem</a></li><li><a href="module-components_Toolbox-ToolboxEdit.html">ToolboxEdit</a></li><li><a href="module-components_Toolbox-ToolboxFilter.html">ToolboxFilter</a></li><li><a href="module-components_Toolbox-ToolboxPage.html">ToolboxPage</a></li><li><a href="module-components_Toolbox-ToolboxShow.html">ToolboxShow</a></li><li><a href="module-components_Toolbox-ViewElem.html">ViewElem</a></li><li><a href="module-components_Toolbox-ViewLinkElem.html">ViewLinkElem</a></li><li><a href="module-components_Toolbox-WrapElem.html">WrapElem</a></li></ul><h3>Classes</h3><ul><li><a href="module-components_elements_utils.ErrorBoundary.html">ErrorBoundary</a></li></ul></div><div class="category"><h2>saltcorn-cli</h2><h3>Modules</h3><ul><li><a href="module-commands_add-schema.html">commands/add-schema</a></li><li><a href="module-commands_backup.html">commands/backup</a></li><li><a href="module-commands_create-tenant.html">commands/create-tenant</a></li><li><a href="module-commands_create-user.html">commands/create-user</a></li><li><a href="module-commands_fixtures.html">commands/fixtures</a></li><li><a href="module-commands_info.html">commands/info</a></li><li><a href="module-commands_install-pack.html">commands/install-pack</a></li><li><a href="module-commands_install-plugin.html">commands/install-plugin</a></li><li><a href="module-commands_list-tenants.html">commands/list-tenants</a></li><li><a href="module-commands_localize-plugin.html">commands/localize-plugin</a></li><li><a href="module-commands_make-migration.html">commands/make-migration</a></li><li><a href="module-commands_migrate.html">commands/migrate</a></li><li><a href="module-commands_plugins.html">commands/plugins</a></li><li><a href="module-commands_release.html">commands/release</a></li><li><a href="module-commands_reset-schema.html">commands/reset-schema</a></li><li><a href="module-commands_restore.html">commands/restore</a></li><li><a href="module-commands_rm-tenant.html">commands/rm-tenant</a></li><li><a href="module-commands_run-benchmark.html">commands/run-benchmark</a></li><li><a href="module-commands_run-tests.html">commands/run-tests</a></li><li><a href="module-commands_scheduler.html">commands/scheduler</a></li><li><a href="module-commands_serve.html">commands/serve</a></li><li><a href="module-commands_set-cfg.html">commands/set-cfg</a></li><li><a href="module-commands_setup.html">commands/setup</a></li><li><a href="module-commands_setup-benchmark.html">commands/setup-benchmark</a></li><li><a href="module-commands_test-plugin.html">commands/test-plugin</a></li><li><a href="module-commands_transform-field.html">commands/transform-field</a></li><li><a href="module-common.html">common</a></li><li><a href="module-saltcorn-cli_index.html">saltcorn-cli/index</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-saltcorn-cli_index-saltcorn-cli_overview.html">saltcorn-cli_overview</a></li></ul><h3>Classes</h3><ul><li><a href="module-commands_add-schema-AddSchemaCommand.html">AddSchemaCommand</a></li><li><a href="module-commands_backup-BackupCommand.html">BackupCommand</a></li><li><a href="module-commands_create-tenant-CreateTenantCommand.html">CreateTenantCommand</a></li><li><a href="module-commands_create-user-CreateUserCommand.html">CreateUserCommand</a></li><li><a href="module-commands_fixtures-FixturesCommand.html">FixturesCommand</a></li><li><a href="module-commands_info-InfoCommand.html">InfoCommand</a></li><li><a href="module-commands_install-pack-InstallPackCommand.html">InstallPackCommand</a></li><li><a href="module-commands_install-plugin-InstallPluginCommand.html">InstallPluginCommand</a></li><li><a href="module-commands_list-tenants-ListTenantsCommand.html">ListTenantsCommand</a></li><li><a href="module-commands_localize-plugin-LocalizePluginCommand.html">LocalizePluginCommand</a></li><li><a href="module-commands_make-migration-MigrationCommand.html">MigrationCommand</a></li><li><a href="module-commands_migrate-MigrateCommand.html">MigrateCommand</a></li><li><a href="module-commands_plugins-PluginsCommand.html">PluginsCommand</a></li><li><a href="module-commands_release-ReleaseCommand.html">ReleaseCommand</a></li><li><a href="module-commands_reset-schema-ResetCommand.html">ResetCommand</a></li><li><a href="module-commands_restore-RestoreCommand.html">RestoreCommand</a></li><li><a href="module-commands_rm-tenant-RmTenantCommand.html">RmTenantCommand</a></li><li><a href="module-commands_run-benchmark-RunBenchmarkCommand.html">RunBenchmarkCommand</a></li><li><a href="module-commands_run-tests-RunTestsCommand.html">RunTestsCommand</a></li><li><a href="module-commands_scheduler-ScheduleCommand.html">ScheduleCommand</a></li><li><a href="module-commands_serve-ServeCommand.html">ServeCommand</a></li><li><a href="module-commands_set-cfg-SetCfgCommand.html">SetCfgCommand</a></li><li><a href="module-commands_setup-benchmark-SetupBenchmarkCommand.html">SetupBenchmarkCommand</a></li><li><a href="module-commands_setup-SetupCommand.html">SetupCommand</a></li><li><a href="module-commands_test-plugin-TestPluginCommand.html">TestPluginCommand</a></li><li><a href="module-commands_transform-field-TransformFieldCommand.html">TransformFieldCommand</a></li></ul></div><div class="category"><h2>saltcorn-data</h2><h3>Modules / base-plugin</h3><ul><li><a href="module-base-plugin_actions.html">base-plugin/actions</a></li><li><a href="module-base-plugin_fieldviews.html">base-plugin/fieldviews</a></li><li><a href="module-base-plugin_fileview.html">base-plugin/fileview</a></li><li><a href="module-base-plugin_index.html">base-plugin/index</a></li><li><a href="module-base-plugin_types.html">base-plugin/types</a></li><li><a href="module-base-plugin_viewtemplates_edit.html">base-plugin/viewtemplates/edit</a></li><li><a href="module-base-plugin_viewtemplates_feed.html">base-plugin/viewtemplates/feed</a></li><li><a href="module-base-plugin_viewtemplates_filter.html">base-plugin/viewtemplates/filter</a></li><li><a href="module-base-plugin_viewtemplates_list.html">base-plugin/viewtemplates/list</a></li><li><a href="module-base-plugin_viewtemplates_listshowlist.html">base-plugin/viewtemplates/listshowlist</a></li><li><a href="module-base-plugin_viewtemplates_room.html">base-plugin/viewtemplates/room</a></li><li><a href="module-base-plugin_viewtemplates_show.html">base-plugin/viewtemplates/show</a></li><li><a href="module-base-plugin_viewtemplates_viewable_fields.html">base-plugin/viewtemplates/viewable_fields</a></li></ul><h3>Modules</h3><ul><li><a href="module-contract.html">contract</a></li><li><a href="module-migrate.html">migrate</a></li><li><a href="module-plugin-helper.html">plugin-helper</a></li><li><a href="module-plugin-testing.html">plugin-testing</a></li><li><a href="module-saltcorn-data_index.html">saltcorn-data/index</a></li><li><a href="module-utils.html">utils</a></li></ul><h3>Modules / db</h3><ul><li><a href="module-db_connect.html">db/connect</a></li><li><a href="module-db_fixtures.html">db/fixtures</a></li><li><a href="module-db_reset_schema.html">db/reset_schema</a></li><li><a href="module-db_state.html">db/state</a></li></ul><h3>Modules / models</h3><ul><li><a href="module-models_backup.html">models/backup</a></li><li><a href="module-models_config.html">models/config</a></li><li><a href="module-models_crash.html">models/crash</a></li><li><a href="module-models_discovery.html">models/discovery</a></li><li><a href="module-models_email.html">models/email</a></li><li><a href="module-models_eventlog.html">models/eventlog</a></li><li><a href="module-models_expression.html">models/expression</a></li><li><a href="module-models_field.html">models/field</a></li><li><a href="module-models_fieldrepeat.html">models/fieldrepeat</a></li><li><a href="module-models_file.html">models/file</a></li><li><a href="module-models_form.html">models/form</a></li><li><a href="module-models_index.html">models/index</a></li><li><a href="module-models_layout.html">models/layout</a></li><li><a href="module-models_library.html">models/library</a></li><li><a href="module-models_pack.html">models/pack</a></li><li><a href="module-models_page.html">models/page</a></li><li><a href="module-models_plugin.html">models/plugin</a></li><li><a href="module-models_random.html">models/random</a></li><li><a href="module-models_scheduler.html">models/scheduler</a></li><li><a href="module-models_table.html">models/table</a></li><li><a href="module-models_table_constraints.html">models/table_constraints</a></li><li><a href="module-models_tenant.html">models/tenant</a></li><li><a href="module-models_trigger.html">models/trigger</a></li><li><a href="module-models_user.html">models/user</a></li><li><a href="module-models_view.html">models/view</a></li><li><a href="module-models_workflow.html">models/workflow</a></li></ul><h3>Namespaces / actions</h3><ul><li><a href="module-base-plugin_actions.blocks.html">blocks</a></li><li><a href="module-base-plugin_actions.duplicate_row.html">duplicate_row</a></li><li><a href="module-base-plugin_actions.emit_event.html">emit_event</a></li><li><a href="module-base-plugin_actions.find_or_create_dm_room.html">find_or_create_dm_room</a></li><li><a href="module-base-plugin_actions.insert_any_row.html">insert_any_row</a></li><li><a href="module-base-plugin_actions.insert_joined_row.html">insert_joined_row</a></li><li><a href="module-base-plugin_actions.recalculate_stored_fields.html">recalculate_stored_fields</a></li><li><a href="module-base-plugin_actions.run_js_code.html">run_js_code</a></li><li><a href="module-base-plugin_actions.send_email.html">send_email</a></li><li><a href="module-base-plugin_actions.webhook.html">webhook</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-base-plugin_fieldviews-radio_select.html">radio_select</a></li><li><a href="module-base-plugin_fieldviews-search_or_create.html">search_or_create</a></li><li><a href="module-base-plugin_fieldviews-select.html">select</a></li><li><a href="module-base-plugin_fileview._Download%2520link_.html">"Download link"</a></li><li><a href="module-base-plugin_fileview._Link%2520(new%2520tab)_.html">"Link (new tab)"</a></li><li><a href="module-base-plugin_fileview._Show%2520Image_.html">"Show Image"</a></li><li><a href="module-base-plugin_fileview.Link.html">Link</a></li><li><a href="module-models_config-configTypes.html">configTypes</a></li><li><a href="module-saltcorn-data_index-saltcorn-data_overview.html">saltcorn-data_overview</a></li></ul><h3>Namespaces / base-plugin</h3><ul><li><a href="module-base-plugin_index-base-plugin_overview.html">base-plugin_overview</a></li></ul><h3>Namespaces / types / bool</h3><ul><li><a href="module-base-plugin_types-bool.html">bool</a></li><li><a href="module-base-plugin_types-bool.fieldviews.html">fieldviews</a></li><li><a href="module-base-plugin_types-bool.fieldviews.checkboxes.html">checkboxes</a></li><li><a href="module-base-plugin_types-bool.fieldviews.edit.html">edit</a></li><li><a href="module-base-plugin_types-bool.fieldviews.show.html">show</a></li><li><a href="module-base-plugin_types-bool.fieldviews.tristate.html">tristate</a></li><li><a href="module-base-plugin_types-bool.fieldviews.TrueFalse.html">TrueFalse</a></li></ul><h3>Namespaces / types / color</h3><ul><li><a href="module-base-plugin_types-color.html">color</a></li><li><a href="module-base-plugin_types-color.fieldviews.html">fieldviews</a></li><li><a href="module-base-plugin_types-color.fieldviews.edit.html">edit</a></li><li><a href="module-base-plugin_types-color.fieldviews.show.html">show</a></li></ul><h3>Namespaces / types / date</h3><ul><li><a href="module-base-plugin_types-date.html">date</a></li><li><a href="module-base-plugin_types-date.fieldviews.html">fieldviews</a></li><li><a href="module-base-plugin_types-date.fieldviews.edit.html">edit</a></li><li><a href="module-base-plugin_types-date.fieldviews.editDay.html">editDay</a></li><li><a href="module-base-plugin_types-date.fieldviews.format.html">format</a></li><li><a href="module-base-plugin_types-date.fieldviews.relative.html">relative</a></li><li><a href="module-base-plugin_types-date.fieldviews.show.html">show</a></li><li><a href="module-base-plugin_types-date.fieldviews.showDay.html">showDay</a></li><li><a href="module-base-plugin_types-date.fieldviews.yearsAgo.html">yearsAgo</a></li><li><a href="module-base-plugin_types-date.presets.html">presets</a></li></ul><h3>Namespaces / types / float</h3><ul><li><a href="module-base-plugin_types-float.html">float</a></li><li><a href="module-base-plugin_types-float.fieldviews.html">fieldviews</a></li><li><a href="module-base-plugin_types-float.fieldviews.edit.html">edit</a></li><li><a href="module-base-plugin_types-float.fieldviews.show.html">show</a></li></ul><h3>Namespaces / types / int</h3><ul><li><a href="module-base-plugin_types-int.html">int</a></li><li><a href="module-base-plugin_types-int.fieldviews.html">fieldviews</a></li><li><a href="module-base-plugin_types-int.fieldviews.edit.html">edit</a></li><li><a href="module-base-plugin_types-int.fieldviews.show.html">show</a></li></ul><h3>Namespaces / types / string</h3><ul><li><a href="module-base-plugin_types-string.html">string</a></li><li><a href="module-base-plugin_types-string.fieldviews.html">fieldviews</a></li><li><a href="module-base-plugin_types-string.fieldviews.as_header.html">as_header</a></li><li><a href="module-base-plugin_types-string.fieldviews.as_link.html">as_link</a></li><li><a href="module-base-plugin_types-string.fieldviews.as_text.html">as_text</a></li><li><a href="module-base-plugin_types-string.fieldviews.edit.html">edit</a></li><li><a href="module-base-plugin_types-string.fieldviews.img_from_url.html">img_from_url</a></li><li><a href="module-base-plugin_types-string.fieldviews.password.html">password</a></li><li><a href="module-base-plugin_types-string.fieldviews.radio_group.html">radio_group</a></li><li><a href="module-base-plugin_types-string.fieldviews.textarea.html">textarea</a></li><li><a href="module-base-plugin_types-string.presets.html">presets</a></li></ul><h3>Namespaces / models</h3><ul><li><a href="module-models_index-models_overview.html">models_overview</a></li></ul><h3>Classes</h3><ul><li><a href="module-db_state-State.html">State</a></li><li><a href="module-models_crash-Crash.html">Crash</a></li><li><a href="module-models_eventlog-EventLog.html">EventLog</a></li><li><a href="module-models_fieldrepeat-FieldRepeat.html">FieldRepeat</a></li><li><a href="module-models_field-Field.html">Field</a></li><li><a href="module-models_file-File.html">File</a></li><li><a href="module-models_form-Form.html">Form</a></li><li><a href="module-models_library-Library.html">Library</a></li><li><a href="module-models_page-Page.html">Page</a></li><li><a href="module-models_plugin-Plugin.html">Plugin</a></li><li><a href="module-models_table_constraints-TableConstraint.html">TableConstraint</a></li><li><a href="module-models_table-Table.html">Table</a></li><li><a href="module-models_trigger-Trigger.html">Trigger</a></li><li><a href="module-models_user-User.html">User</a></li><li><a href="module-models_view-View.html">View</a></li><li><a href="module-models_workflow-Workflow.html">Workflow</a></li></ul></div><div class="category"><h2>saltcorn-markup</h2><h3>Modules</h3><ul><li><a href="module-builder.html">builder</a></li><li><a href="module-emergency_layout.html">emergency_layout</a></li><li><a href="module-form.html">form</a></li><li><a href="module-helpers.html">helpers</a></li><li><a href="module-layout.html">layout</a></li><li><a href="module-layout_utils.html">layout_utils</a></li><li><a href="module-mktag.html">mktag</a></li><li><a href="module-saltcorn-markup_index.html">saltcorn-markup/index</a></li><li><a href="module-table.html">table</a></li><li><a href="module-tabs.html">tabs</a></li><li><a href="module-tags.html">tags</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-saltcorn-markup_index-saltcorn-markup_overview.html">saltcorn-markup_overview</a></li></ul></div><div class="category"><h2>saltcorn-sbadmin2</h2><h3>Modules</h3><ul><li><a href="module-saltcorn-sbadmin2_index.html">saltcorn-sbadmin2/index</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-saltcorn-sbadmin2_index-blockDispatch.html">blockDispatch</a></li></ul></div><div class="category"><h2>server</h2><h3>Modules</h3><ul><li><a href="module-app.html">app</a></li><li><a href="module-errors.html">errors</a></li><li><a href="module-fixture_persons.html">fixture_persons</a></li><li><a href="module-load_plugins.html">load_plugins</a></li><li><a href="module-restart_watcher.html">restart_watcher</a></li><li><a href="module-serve.html">serve</a></li><li><a href="module-server_index.html">server/index</a></li><li><a href="module-systemd.html">systemd</a></li><li><a href="module-wrapper.html">wrapper</a></li></ul><h3>Modules / auth</h3><ul><li><a href="module-auth_admin.html">auth/admin</a></li><li><a href="module-auth_index.html">auth/index</a></li><li><a href="module-auth_resetpw.html">auth/resetpw</a></li><li><a href="module-auth_roleadmin.html">auth/roleadmin</a></li><li><a href="module-auth_routes.html">auth/routes</a></li><li><a href="module-auth_testhelp.html">auth/testhelp</a></li></ul><h3>Modules / markup</h3><ul><li><a href="module-markup_admin.html">markup/admin</a></li><li><a href="module-markup_blockly.html">markup/blockly</a></li><li><a href="module-markup_expression_blurb.html">markup/expression_blurb</a></li><li><a href="module-markup_forms.html">markup/forms</a></li><li><a href="module-markup_index.html">markup/index</a></li><li><a href="module-markup_plugin-store.html">markup/plugin-store</a></li></ul><h3>Modules / routes</h3><ul><li><a href="module-routes_actions.html">routes/actions</a></li><li><a href="module-routes_admin.html">routes/admin</a></li><li><a href="module-routes_api.html">routes/api</a></li><li><a href="module-routes_config.html">routes/config</a></li><li><a href="module-routes_crashlog.html">routes/crashlog</a></li><li><a href="module-routes_delete.html">routes/delete</a></li><li><a href="module-routes_edit.html">routes/edit</a></li><li><a href="module-routes_eventlog.html">routes/eventlog</a></li><li><a href="module-routes_events.html">routes/events</a></li><li><a href="module-routes_fields.html">routes/fields</a></li><li><a href="module-routes_files.html">routes/files</a></li><li><a href="module-routes_homepage.html">routes/homepage</a></li><li><a href="module-routes_index.html">routes/index</a></li><li><a href="module-routes_infoarch.html">routes/infoarch</a></li><li><a href="module-routes_library.html">routes/library</a></li><li><a href="module-routes_list.html">routes/list</a></li><li><a href="module-routes_menu.html">routes/menu</a></li><li><a href="module-routes_packs.html">routes/packs</a></li><li><a href="module-routes_page.html">routes/page</a></li><li><a href="module-routes_pageedit.html">routes/pageedit</a></li><li><a href="module-routes_plugins.html">routes/plugins</a></li><li><a href="module-routes_scapi.html">routes/scapi</a></li><li><a href="module-routes_search.html">routes/search</a></li><li><a href="module-routes_settings.html">routes/settings</a></li><li><a href="module-routes_tables.html">routes/tables</a></li><li><a href="module-routes_tenant.html">routes/tenant</a></li><li><a href="module-routes_utils.html">routes/utils</a></li><li><a href="module-routes_view.html">routes/view</a></li><li><a href="module-routes_viewedit.html">routes/viewedit</a></li></ul><h3>Namespaces / auth</h3><ul><li><a href="module-auth_admin-auth_adminRouter.html">auth/adminRouter</a></li><li><a href="module-auth_index-auth_overview.html">auth_overview</a></li><li><a href="module-auth_roleadmin-roleadminRouter.html">roleadminRouter</a></li><li><a href="module-auth_routes-routesRouter.html">routesRouter</a></li></ul><h3>Namespaces / markup</h3><ul><li><a href="module-markup_index-markup_overview.html">markup_overview</a></li></ul><h3>Namespaces / routes</h3><ul><li><a href="module-routes_actions-actionsRouter.html">actionsRouter</a></li><li><a href="module-routes_admin-routes_adminRouter.html">routes/adminRouter</a></li><li><a href="module-routes_api-apiRouter.html">apiRouter</a></li><li><a href="module-routes_config-configRouter.html">configRouter</a></li><li><a href="module-routes_crashlog-crashlogRouter.html">crashlogRouter</a></li><li><a href="module-routes_delete-deleteRouter.html">deleteRouter</a></li><li><a href="module-routes_edit-editRouter.html">editRouter</a></li><li><a href="module-routes_eventlog-eventlogRouter.html">eventlogRouter</a></li><li><a href="module-routes_events-eventsRouter.html">eventsRouter</a></li><li><a href="module-routes_fields-fieldsRouter.html">fieldsRouter</a></li><li><a href="module-routes_files-filesRouter.html">filesRouter</a></li><li><a href="module-routes_index-routes_overview.html">routes_overview</a></li><li><a href="module-routes_infoarch-infoarchRouter.html">infoarchRouter</a></li><li><a href="module-routes_library-libraryRouter.html">libraryRouter</a></li><li><a href="module-routes_list-listRouter.html">listRouter</a></li><li><a href="module-routes_menu-menuRouter.html">menuRouter</a></li><li><a href="module-routes_packs-packsRouter.html">packsRouter</a></li><li><a href="module-routes_pageedit-pageeditRouter.html">pageeditRouter</a></li><li><a href="module-routes_page-pageRouter.html">pageRouter</a></li><li><a href="module-routes_plugins-pluginsRouter.html">pluginsRouter</a></li><li><a href="module-routes_scapi-scapiRouter.html">scapiRouter</a></li><li><a href="module-routes_search-searchRouter.html">searchRouter</a></li><li><a href="module-routes_settings-settingsRouter.html">settingsRouter</a></li><li><a href="module-routes_tables-tablesRouter.html">tablesRouter</a></li><li><a href="module-routes_tenant-tenantRouter.html">tenantRouter</a></li><li><a href="module-routes_viewedit-vieweditRouter.html">vieweditRouter</a></li><li><a href="module-routes_view-viewRouter.html">viewRouter</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-server_index-server_overview.html">server_overview</a></li></ul></div><div class="category"><h2>sqlite</h2><h3>Modules</h3><ul><li><a href="module-sqlite.html">sqlite</a></li><li><a href="module-sqlite_index.html">sqlite/index</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-sqlite_index-sqlite_overview.html">sqlite_overview</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>saltcorn-data/models/table.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Table Database Access Layer
 * @category saltcorn-data
 * @module models/table
 * @subcategory models
 */
const db = require("../db");
const {
  sqlsanitize,
  mkWhere,
  mkSelectOptions,
} = require("@saltcorn/db-common/internal");
const Field = require("./field");
const Trigger = require("./trigger");
const {
  apply_calculated_fields,
  apply_calculated_fields_stored,
  recalculate_for_stored,
  get_expression_function,
} = require("./expression");
const { contract, is } = require("contractis");
const { is_table_query } = require("../contracts");
const csvtojson = require("csvtojson");
const moment = require("moment");
const fs = require("fs");
const {
  InvalidConfiguration,
  InvalidAdminAction,
  satisfies,
  structuredClone,
  getLines,
} = require("../utils");
/**
 * Transponce Objects
 * TODO more detailed explanation
 * TODO refactor - move to object util module?
 * @param objs
 * @returns {object}
 */
const transposeObjects = (objs) => {
  const keys = new Set();
  for (const o of objs) {
    Object.keys(o).forEach((k) => keys.add(k));
  }
  const res = {};
  keys.forEach((k) => {
    res[k] = [];
  });
  for (const o of objs) {
    keys.forEach((k) => {
      res[k].push(o[k]);
    });
  }
  return res;
};
// todo support also other date formats https://momentjs.com/docs/
const dateFormats = [moment.ISO_8601];
// todo refactor - move to separated data utils module?
/**
 * Is Valid Date of format moment.ISO_8601,
 * example 2010-01-01T05:06:07
 *
 * @param date
 * @returns {boolean}
 */
const isDate = function (date) {
  return moment(date, dateFormats, true).isValid();
};
// todo resolve database specific
/**
 * Normalise specific error message according db specific
 * @param msg
 * @returns {string}
 */
// todo refactor
const normalise_error_message = (msg) =>
  db.isSQLite
    ? msg.replace(
        /SQLITE_CONSTRAINT: UNIQUE constraint failed: (.*?)\.(.*?)/,
        "Duplicate value for unique field: $2"
      )
    : msg.replace(
        /duplicate key value violates unique constraint "(.*?)_(.*?)_unique"/,
        "Duplicate value for unique field: $2"
      );

/**
 * Table class
 * @category saltcorn-data
 */
class Table {
  /**
   * Table constructor
   * @param {object} o
   */
  constructor(o) {
    this.name = o.name;
    this.id = o.id;
    this.min_role_read = o.min_role_read;
    this.min_role_write = o.min_role_write;
    this.ownership_field_id = o.ownership_field_id;
    this.ownership_formula = o.ownership_formula;
    this.versioned = !!o.versioned;
    this.external = false;
    this.description = o.description;
    if (o.fields) this.fields = o.fields.map((f) => new Field(f));
    contract.class(this);
  }

  /**
   *
   * Find one Table
   * @param where - where condition
   * @returns {*|Table|null} table or null
   */
  static findOne(where) {
    if (
      where &amp;&amp;
      ((where.constructor &amp;&amp; where.constructor.name === "Table") ||
        where.getRows)
    )
      return where;
    if (typeof where === "string") return Table.findOne({ name: where });
    if (typeof where === "number") return Table.findOne({ id: where });
    if (where.name) {
      const { getState } = require("../db/state");
      const extTable = getState().external_tables[where.name];
      if (extTable) return extTable;
    }
    const { getState } = require("../db/state");
    const tbl = getState().tables.find(
      where.id
        ? (v) => v.id === +where.id
        : where.name
        ? (v) => v.name === where.name
        : satisfies(where)
    );
    return tbl ? new Table(structuredClone(tbl)) : null;
  }

  /**
   * Find Tables
   * @param where - where condition
   * @param selectopts - options
   * @returns {Promise&lt;Table[]>} table list
   */
  static async find(where, selectopts = { orderBy: "name", nocase: true }) {
    if (selectopts.cached) {
      const { getState } = require("../db/state");
      return getState().tables.map((t) => new Table(t));
    }
    const tbls = await db.select("_sc_tables", where, selectopts);

    return tbls.map((t) => new Table(t));
  }

  /**
   * Find Tables including external tables
   * @param where0
   * @param selectopts
   * @returns {Promise&lt;object[]>}
   */
  static async find_with_external(
    where0 = {},
    selectopts = { orderBy: "name", nocase: true }
  ) {
    const { external, ...where } = where0;
    let externals = [],
      dbs = [];
    if (external !== false) {
      //do include externals
      const { getState } = require("../db/state");
      externals = Object.values(getState().external_tables);
    }
    if (external !== true) {
      //do include db tables
      const tbls = await db.select("_sc_tables", where, selectopts);
      dbs = tbls.map((t) => new Table(t));
    }
    return [...dbs, ...externals];
  }

  /**
   * Get owner column name
   * @param fields - fields list
   * @returns {null|*} null or owner column name
   */
  owner_fieldname_from_fields(fields) {
    if (!this.ownership_field_id) return null;
    const field = fields.find((f) => f.id === this.ownership_field_id);
    return field.name;
  }

  /**
   * Get owner column name
   * @returns {Promise&lt;string|null|*>}
   */
  owner_fieldname() {
    if (this.name === "users") return "id";
    if (!this.ownership_field_id) return null;
    return this.owner_fieldname_from_fields(this.fields);
  }

  /**
   * Check if user is owner of row
   * @param user - user
   * @param row - table row
   * @returns {Promise&lt;string|null|*|boolean>}
   */
  is_owner(user, row) {
    if (!user) return false;
    if (this.ownership_formula) {
      const f = get_expression_function(this.ownership_formula, this.fields);
      return f(row, user);
    }
    const field_name = this.owner_fieldname();
    return field_name &amp;&amp; row[field_name] === user.id;
  }

  /**
   * Create table
   * @param name - table name
   * @param options - table fields
   * @returns {Promise&lt;Table>} table
   */
  static async create(name, options = {}) {
    const schema = db.getTenantSchemaPrefix();
    // create table in database
    await db.query(
      `create table ${schema}"${sqlsanitize(name)}" (id ${
        db.isSQLite ? "integer" : "serial"
      } primary key)`
    );
    // populate table definition row
    const tblrow = {
      name,
      versioned: options.versioned || false,
      min_role_read: options.min_role_read || 1,
      min_role_write: options.min_role_write || 1,
      ownership_field_id: options.ownership_field_id,
      ownership_formula: options.ownership_formula,
      description: options.description || "",
    };
    // insert table defintion into _sc_tables
    const id = await db.insert("_sc_tables", tblrow);
    // add primary key columnt ID
    await db.query(
      `insert into ${schema}_sc_fields(table_id, name, label, type, attributes, required, is_unique,primary_key)
          values($1,'id','ID','Integer', '{}', true, true, true)`,
      [id]
    );
    // create table
    const table = new Table({ ...tblrow, id });
    // create table history
    if (table.versioned) await table.create_history_table();
    // refresh tables cache
    await require("../db/state").getState().refresh_tables();

    return table;
  }

  /**
   * Drop current table
   * @returns {Promise&lt;void>}
   */
  async delete(only_forget = false) {
    const schema = db.getTenantSchemaPrefix();
    const is_sqlite = db.isSQLite;
    await this.update({ ownership_field_id: null });
    const client = is_sqlite ? db : await db.getClient();
    await client.query(`BEGIN`);
    try {
      if (!only_forget)
        await client.query(
          `drop table if exists ${schema}"${sqlsanitize(this.name)}"`
        );
      await client.query(
        `delete FROM ${schema}_sc_fields WHERE table_id = $1`,
        [this.id]
      );

      await client.query(`delete FROM ${schema}_sc_tables WHERE id = $1`, [
        this.id,
      ]);
      if (this.versioned)
        await client.query(
          `drop table if exists ${schema}"${sqlsanitize(this.name)}__history"`
        );

      await client.query(`COMMIT`);
    } catch (e) {
      await client.query(`ROLLBACK`);
      if (!is_sqlite) client.release(true);
      throw e;
    }
    if (!is_sqlite) client.release(true);
    await require("../db/state").getState().refresh_tables();
  }

  /***
   * get Table SQL Name
   * @type {string}
   */
  get sql_name() {
    return `${db.getTenantSchemaPrefix()}"${sqlsanitize(this.name)}"`;
  }

  /**
   * Delete rows from table
   * @param where - condition
   * @returns {Promise&lt;void>}
   */
  async deleteRows(where) {
    // get triggers on delete
    const triggers = await Trigger.getTableTriggers("Delete", this);
    if (triggers.length > 0) {
      const rows = await this.getRows(where);
      for (const trigger of triggers) {
        for (const row of rows) {
          // run triggers on delete
          await trigger.run(row);
        }
      }
    }
    await db.deleteWhere(this.name, where);
  }

  /**
   * Returns row with only fields that can be read from db (readFromDB flag)
   * @param row
   * @returns {*}
   */
  readFromDB(row) {
    for (const f of this.fields) {
      if (f.type &amp;&amp; f.type.readFromDB)
        row[f.name] = f.type.readFromDB(row[f.name]);
    }
    return row;
  }

  /**
   * Get one row from table in db
   * @param where
   * @returns {Promise&lt;null|*>}
   */
  async getRow(where = {}) {
    await this.getFields();
    const row = await db.selectMaybeOne(this.name, where);
    if (!row) return null;
    return apply_calculated_fields([this.readFromDB(row)], this.fields)[0];
  }

  /**
   * Get rows from Table in db
   * @param where
   * @param selopts
   * @returns {Promise&lt;void>}
   */
  async getRows(where = {}, selopts) {
    await this.getFields();
    const rows = await db.select(this.name, where, selopts);
    return apply_calculated_fields(
      rows.map((r) => this.readFromDB(r)),
      this.fields
    );
  }

  /**
   * Count amount of rows in db table
   * @param where
   * @returns {Promise&lt;number>}
   */
  async countRows(where) {
    return await db.count(this.name, where);
  }

  /**
   * Return distinct Values for column in table
   * ????
   * @param fieldnm
   * @returns {Promise&lt;Object[]>}
   */
  async distinctValues(fieldnm) {
    const res = await db.query(
      `select distinct "${db.sqlsanitize(fieldnm)}" from ${this.sql_name}`
    );
    return res.rows.map((r) => r[fieldnm]);
  }

  /**
   * Update row
   * @param v_in - colums with values to update
   * @param id - id value
   * @param _userid - user id
   * @returns {Promise&lt;void>}
   */
  async updateRow(v_in, id, _userid) {
    let existing;
    let v;
    const fields = await this.getFields();
    const pk_name = this.pk_name;
    if (fields.some((f) => f.calculated &amp;&amp; f.stored)) {
      existing = await db.selectOne(this.name, { [pk_name]: id });
      v = await apply_calculated_fields_stored(
        { ...existing, ...v_in },
        this.fields
      );
    } else v = v_in;
    if (this.versioned) {
      if (!existing)
        existing = await db.selectOne(this.name, { [pk_name]: id });
      await db.insert(this.name + "__history", {
        ...existing,
        ...v,
        [pk_name]: id,
        _version: {
          next_version_by_id: +id,
        },
        _time: new Date(),
        _userid,
      });
    }
    await db.update(this.name, v, id, { pk_name });
    if (typeof existing === "undefined") {
      const triggers = await Trigger.getTableTriggers("Update", this);
      if (triggers.length > 0)
        existing = await db.selectOne(this.name, { [pk_name]: id });
    }
    const newRow = { ...existing, ...v, [pk_name]: id };
    await Trigger.runTableTriggers("Update", this, newRow);
  }

  /**
   * Try to Update row
   * @param v
   * @param id
   * @param _userid
   * @returns {Promise&lt;{error}|{success: boolean}>}
   */
  async tryUpdateRow(v, id, _userid) {
    try {
      await this.updateRow(v, id, _userid);
      return { success: true };
    } catch (e) {
      return { error: normalise_error_message(e.message) };
    }
  }

  /**
   * ????
   * @param id
   * @param field_name
   * @returns {Promise&lt;void>}
   */
  async toggleBool(id, field_name) {
    const schema = db.getTenantSchemaPrefix();
    await db.query(
      `update ${schema}"${sqlsanitize(this.name)}" set "${sqlsanitize(
        field_name
      )}"=NOT coalesce("${sqlsanitize(field_name)}", false) where id=$1`,
      [id]
    );
    const triggers = await Trigger.getTableTriggers("Update", this);
    if (triggers.length > 0) {
      const row = await this.getRow({ id });
      for (const trigger of triggers) {
        await trigger.run(row);
      }
    }
  }

  /**
   * Get primary key field
   * @type {string}
   */
  get pk_name() {
    return this.fields.find((f) => f.primary_key).name;
  }

  /**
   * Insert row
   * @param v_in
   * @param _userid
   * @returns {Promise&lt;*>}
   */
  async insertRow(v_in, _userid) {
    await this.getFields();
    const v = await apply_calculated_fields_stored(v_in, this.fields);
    const pk_name = this.pk_name;
    const id = await db.insert(this.name, v, { pk_name });
    if (this.versioned)
      await db.insert(this.name + "__history", {
        ...v,
        [pk_name]: id,
        _version: 1,
        _userid,
        _time: new Date(),
      });
    Trigger.runTableTriggers("Insert", this, { [pk_name]: id, ...v });
    return id;
  }

  /**
   * Try to Insert row
   * @param v
   * @param _userid
   * @returns {Promise&lt;{error}|{success: *}>}
   */
  async tryInsertRow(v, _userid) {
    try {
      const id = await this.insertRow(v, _userid);
      return { success: id };
    } catch (e) {
      return { error: normalise_error_message(e.message) };
    }
  }

  /**
   * Get Fields list for table
   * @returns {Promise&lt;Field[]>}
   */
  async getFields() {
    if (!this.fields) {
      this.fields = await Field.find({ table_id: this.id }, { orderBy: "id" });
    }
    return this.fields;
  }

  /**
   * Create history table
   * @returns {Promise&lt;void>}
   */
  // todo create function that returns history table name for table
  async create_history_table() {
    const schemaPrefix = db.getTenantSchemaPrefix();

    const fields = await this.getFields();
    const flds = fields.map(
      (f) => `,"${sqlsanitize(f.name)}" ${f.sql_bare_type}`
    );
    const pk = fields.find((f) => f.primary_key).name;

    // create history table
    await db.query(
      `create table ${schemaPrefix}"${sqlsanitize(this.name)}__history" (
          _version integer,
          _time timestamp,
          _userid integer
          ${flds.join("")}
          ,PRIMARY KEY("${pk}", _version)
          );`
    );
  }

  /**
   * Drop history table
   * @returns {Promise&lt;void>}
   */
  async drop_history_table() {
    const schemaPrefix = db.getTenantSchemaPrefix();

    await db.query(`
      drop table ${schemaPrefix}"${sqlsanitize(this.name)}__history";`);
  }

  /**
   * Rename table
   * @param new_name
   * @returns {Promise&lt;void>}
   */
  async rename(new_name) {
    //in transaction
    if (db.isSQLite)
      throw new InvalidAdminAction("Cannot rename table on SQLite");
    const schemaPrefix = db.getTenantSchemaPrefix();

    const client = await db.getClient();
    await client.query(`BEGIN`);
    try {
      //rename table
      await db.query(
        `alter table ${schemaPrefix}"${sqlsanitize(
          this.name
        )}" rename to "${sqlsanitize(new_name)}";`
      );
      //change refs
      await db.query(
        `update ${schemaPrefix}_sc_fields set reftable_name=$1 where reftable_name=$2`,
        [sqlsanitize(new_name), sqlsanitize(this.name)]
      );
      //rename history
      if (this.versioned)
        await db.query(
          `alter table ${schemaPrefix}"${sqlsanitize(
            this.name
          )}__history" rename to "${sqlsanitize(new_name)}__history";`
        );
      //1. change record
      await this.update({ name: new_name });
      await client.query(`COMMIT`);
    } catch (e) {
      await client.query(`ROLLBACK`);
      client.release(true);
      throw e;
    }
    client.release(true);
    await require("../db/state").getState().refresh_tables();
  }

  /**
   * Update Table description in _sc_table
   * Also creates / drops history table for table
   * @param new_table_rec
   * @returns {Promise&lt;void>}
   */
  async update(new_table_rec) {
    if (new_table_rec.ownership_field_id === "")
      delete new_table_rec.ownership_field_id;
    const existing = await Table.findOne({ id: this.id });
    const { external, fields, ...upd_rec } = new_table_rec;
    await db.update("_sc_tables", upd_rec, this.id);
    await require("../db/state").getState().refresh_tables();

    const new_table = await Table.findOne({ id: this.id });

    if (new_table.versioned &amp;&amp; !existing.versioned) {
      await new_table.create_history_table();
    } else if (!new_table.versioned &amp;&amp; existing.versioned) {
      await new_table.drop_history_table();
    }
    Object.assign(this, new_table_rec);
  }

  /**
   * Get table history data
   * @param id
   * @returns {Promise&lt;*>}
   */
  async get_history(id) {
    return await db.select(
      `${sqlsanitize(this.name)}__history`,
      { id },
      { orderBy: "_version" }
    );
  }

  /**
   * Enable constraints
   * @returns {Promise&lt;void>}
   */
  async enable_fkey_constraints() {
    const fields = await this.getFields();
    for (const f of fields) await f.enable_fkey_constraint(this);
  }

  /**
   * Table Create from CSV
   * @param name
   * @param filePath
   * @returns {Promise&lt;{error: string}|{error: string}|{error: string}|{error: string}|{error: string}|{success: string}|{error: (string|string|*)}>}
   */
  static async create_from_csv(name, filePath) {
    let rows;
    try {
      const s = await getLines(filePath, 500);
      rows = await csvtojson().fromString(s); // todo agrument type unknown
    } catch (e) {
      return { error: `Error processing CSV file` };
    }
    const rowsTr = transposeObjects(rows);
    const table = await Table.create(name);
    for (const [k, vs] of Object.entries(rowsTr)) {
      const required = vs.every((v) => v !== "");
      const nonEmpties = vs.filter((v) => v !== "");
      const isBools = "true false yes no on off y n t f".split(" ");
      let type;
      if (
        nonEmpties.every((v) =>
          //https://www.postgresql.org/docs/11/datatype-boolean.html

          isBools.includes(v &amp;&amp; v.toLowerCase &amp;&amp; v.toLowerCase())
        )
      )
        type = "Bool";
      else if (nonEmpties.every((v) => !isNaN(v)))
        if (nonEmpties.every((v) => Number.isSafeInteger(+v))) type = "Integer";
        else type = "Float";
      else if (nonEmpties.every((v) => isDate(v))) type = "Date";
      else type = "String";
      const label = (k.charAt(0).toUpperCase() + k.slice(1)).replace(/_/g, " ");

      //can fail here if: non integer i d, duplicate headers, invalid name
      const fld = new Field({
        name: Field.labelToName(k),
        required,
        type,
        table,
        label,
      });
      if (db.sqlsanitize(k.toLowerCase()) === "id") {
        if (type !== "Integer") {
          await table.delete();
          return { error: `Columns named "id" must have only integers` };
        }
        if (!required) {
          await table.delete();
          return { error: `Columns named "id" must not have missing values` };
        }
        continue;
      }
      if (db.sqlsanitize(fld.name) === "") {
        await table.delete();
        return {
          error: `Invalid column name ${k} - Use A-Z, a-z, 0-9, _ only`,
        };
      }
      try {
        await Field.create(fld);
      } catch (e) {
        await table.delete();
        return { error: `Error in header ${k}: ${e.message}` };
      }
    }
    const parse_res = await table.import_csv_file(filePath);
    if (parse_res.error) {
      await table.delete();
      return { error: parse_res.error };
    }

    parse_res.table = table;
    await require("../db/state").getState().refresh_tables();

    return parse_res;
  }

  /**
   * Import CSV file to existing table
   * @param filePath
   * @param recalc_stored
   * @param skip_first_data_row
   * @returns {Promise&lt;{error: string}|{success: string}>}
   */
  async import_csv_file(filePath, recalc_stored, skip_first_data_row) {
    let headers;
    const { readStateStrict } = require("../plugin-helper");
    try {
      const s = await getLines(filePath, 1);
      [headers] = await csvtojson({
        output: "csv",
        noheader: true,
      }).fromString(s); // todo agrument type unknown
    } catch (e) {
      return { error: `Error processing CSV file` };
    }
    const fields = (await this.getFields()).filter((f) => !f.calculated);
    const okHeaders = {};
    const pk_name = this.pk_name;
    const renames = [];
    for (const f of fields) {
      if (headers.includes(f.name)) okHeaders[f.name] = f;
      else if (headers.includes(f.label)) {
        okHeaders[f.label] = f;
        renames.push({ from: f.label, to: f.name });
      } else if (f.required &amp;&amp; !f.primary_key)
        return { error: `Required field missing: ${f.label}` };
    }
    const fieldNames = headers.map((hnm) => {
      if (okHeaders[hnm]) return okHeaders[hnm].name;
    });
    // also id
    if (headers.includes(`id`)) okHeaders.id = { type: "Integer" };
    const colRe = new RegExp(`(${Object.keys(okHeaders).join("|")})`);

    let i = 1;
    let rejects = 0;
    const client = db.isSQLite ? db : await db.getClient();

    const stats = await fs.promises.stat(filePath);
    const fileSizeInMegabytes = stats.size / (1024 * 1024);

    await client.query("BEGIN");

    const readStream = fs.createReadStream(filePath);

    try {
      if (db.copyFrom &amp;&amp; fileSizeInMegabytes > 1) {
        let theError;

        const copyres = await db
          .copyFrom(readStream, this.name, fieldNames, client)
          .catch((cate) => {
            theError = cate;
          });
        if (theError || (copyres &amp;&amp; copyres.error)) {
          theError = theError || copyres.error;
          return {
            error: `Error processing CSV file: ${
              !theError
                ? theError
                : theError.error || theError.message || theError
            }`,
          };
        }
      } else {
        await new Promise((resolve, reject) => {
          csvtojson({
            includeColumns: colRe,
          })
            .fromStream(readStream)
            .subscribe(
              async (rec) => {
                i += 1;
                if (skip_first_data_row &amp;&amp; i === 2) return;
                try {
                  renames.forEach(({ from, to }) => {
                    rec[to] = rec[from];
                    delete rec[from];
                  });
                  const rowOk = readStateStrict(rec, fields);
                  if (rowOk)
                    await db.insert(this.name, rec, {
                      noid: true,
                      client,
                      pk_name,
                    });
                  else rejects += 1;
                } catch (e) {
                  await client.query("ROLLBACK");

                  if (!db.isSQLite) await client.release(true);
                  reject({ error: `${e.message} in row ${i}` });
                }
              },
              (err) => {
                reject({ error: !err ? err : err.message || err });
              },
              () => {
                resolve();
              }
            );
        });
        readStream.destroy();
      }
    } catch (e) {
      return {
        error: `Error processing CSV file: ${
          !e ? e : e.error || e.message || e
        }`,
      };
    }

    await client.query("COMMIT");

    if (!db.isSQLite) await client.release(true);
    const pk = fields.find((f) => f.primary_key);
    if (db.reset_sequence &amp;&amp; pk.type.name === "Integer")
      await db.reset_sequence(this.name);

    if (recalc_stored &amp;&amp; this.fields.some((f) => f.calculated &amp;&amp; f.stored)) {
      await recalculate_for_stored(this);
    }
    return {
      success:
        `Imported ${i > 1 ? i - 1 - rejects : ""} rows into table ${
          this.name
        }` + (rejects ? `. Rejected ${rejects} rows.` : ""),
    };
  }

  /**
   * Import JSON table description
   * @param filePath
   * @param skip_first_data_row
   * @returns {Promise&lt;{error: string}|{success: string}>}
   */
  async import_json_file(filePath, skip_first_data_row) {
    // todo argument type buffer is not assignable for type String...
    const file_rows = JSON.parse(await fs.promises.readFile(filePath));
    const fields = await this.getFields();
    const pk_name = this.pk_name;
    const { readState } = require("../plugin-helper");

    let i = 1;
    const client = db.isSQLite ? db : await db.getClient();
    await client.query("BEGIN");
    for (const rec of file_rows) {
      i += 1;
      if (skip_first_data_row &amp;&amp; i === 2) continue;
      fields
        .filter((f) => f.calculated &amp;&amp; !f.stored)
        .forEach((f) => {
          if (typeof rec[f.name] !== "undefined") {
            delete rec[f.name];
          }
        });
      try {
        readState(rec, fields);
        await db.insert(this.name, rec, { noid: true, client, pk_name });
      } catch (e) {
        await client.query("ROLLBACK");

        if (!db.isSQLite) await client.release(true);
        return { error: `${e.message} in row ${i}` };
      }
    }
    await client.query("COMMIT");
    if (!db.isSQLite) await client.release(true);
    const pk = fields.find((f) => f.primary_key);
    if (db.reset_sequence &amp;&amp; pk.type.name === "Integer")
      await db.reset_sequence(this.name);

    return {
      success: `Imported ${file_rows.length} rows into table ${this.name}`,
    };
  }

  /**
   * Get parent relations for table
   * @param allow_double
   * @returns {Promise&lt;{parent_relations: object[], parent_field_list: object[]}>}
   */
  async get_parent_relations(allow_double) {
    const fields = await this.getFields();
    let parent_relations = [];
    let parent_field_list = [];
    for (const f of fields) {
      if (f.is_fkey &amp;&amp; f.type !== "File") {
        const table = await Table.findOne({ name: f.reftable_name });
        await table.getFields();
        for (const pf of table.fields.filter(
          (f) => !f.calculated || f.stored
        )) {
          parent_field_list.push(`${f.name}.${pf.name}`);
          if (pf.is_fkey &amp;&amp; pf.type !== "File" &amp;&amp; allow_double) {
            const table1 = await Table.findOne({ name: pf.reftable_name });
            await table1.getFields();
            for (const gpf of table1.fields.filter(
              (f) => !f.calculated || f.stored
            )) {
              parent_field_list.push(`${f.name}.${pf.name}.${gpf.name}`);
            }
            parent_relations.push({ key_field: pf, through: f, table: table1 });
          }
        }
        parent_relations.push({ key_field: f, table });
      }
    }
    return { parent_relations, parent_field_list };
  }

  /**
   * Get child relations for table
   * @returns {Promise&lt;{child_relations: object[], child_field_list: object[]}>}
   */
  async get_child_relations() {
    const cfields = await Field.find({ reftable_name: this.name });
    let child_relations = [];
    let child_field_list = [];
    for (const f of cfields) {
      if (f.is_fkey) {
        const table = await Table.findOne({ id: f.table_id });
        child_field_list.push(`${table.name}.${f.name}`);
        await table.getFields();
        child_relations.push({ key_field: f, table });
      }
    }
    return { child_relations, child_field_list };
  }

  /**
   *
   * @param opts
   * @returns {Promise&lt;{values, sql: string}>}
   */
  async getJoinedQuery(opts = {}) {
    const fields = await this.getFields();
    let fldNms = [];
    let joinq = "";
    let joinTables = [];
    let joinFields = opts.joinFields || [];
    const schema = db.getTenantSchemaPrefix();

    fields
      .filter((f) => f.type === "File")
      .forEach((f) => {
        joinFields[`${f.name}__filename`] = {
          ref: f.name,
          reftable: "_sc_files",
          target: `filename`,
        };
      });
    for (const [fldnm, { ref, target, through }] of Object.entries(
      joinFields
    )) {
      const reffield = fields.find((f) => f.name === ref);
      if (!reffield)
        throw new InvalidConfiguration(
          `Key field ${ref} not found in table ${this.name}`
        );
      const reftable = reffield.reftable_name;
      if (!reftable)
        throw new InvalidConfiguration(`Field ${ref} is not a key field`);
      const jtNm = `${sqlsanitize(reftable)}_jt_${sqlsanitize(ref)}`;
      if (!joinTables.includes(jtNm)) {
        joinTables.push(jtNm);
        joinq += ` left join ${schema}"${sqlsanitize(
          reftable
        )}" ${jtNm} on ${jtNm}."${reffield.refname}"=a."${sqlsanitize(ref)}"`;
      }
      if (through) {
        const throughTable = await Table.findOne({
          name: reffield.reftable_name,
        });
        if (!throughTable)
          throw new InvalidConfiguration(
            `Join-through table ${reffield.reftable_name} not found`
          );
        const throughTableFields = await throughTable.getFields();
        const throughRefField = throughTableFields.find(
          (f) => f.name === through
        );
        if (!throughRefField)
          throw new InvalidConfiguration(
            `Reference field field ${through} not found in table ${throughTable.name}`
          );
        const finalTable = throughRefField.reftable_name;
        const jtNm1 = `${sqlsanitize(reftable)}_jt_${sqlsanitize(
          through
        )}_jt_${sqlsanitize(ref)}`;
        if (!joinTables.includes(jtNm1)) {
          joinTables.push(jtNm1);
          joinq += ` left join ${schema}"${sqlsanitize(
            finalTable
          )}" ${jtNm1} on ${jtNm1}.id=${jtNm}."${sqlsanitize(through)}"`;
        }
        fldNms.push(`${jtNm1}.${sqlsanitize(target)} as ${sqlsanitize(fldnm)}`);
      } else {
        fldNms.push(`${jtNm}.${sqlsanitize(target)} as ${sqlsanitize(fldnm)}`);
      }
    }
    for (const f of fields.filter((f) => !f.calculated || f.stored)) {
      fldNms.push(`a."${sqlsanitize(f.name)}"`);
    }
    Object.entries(opts.aggregations || {}).forEach(
      ([fldnm, { table, ref, field, where, aggregate, subselect }]) => {
        if (aggregate.startsWith("Latest ")) {
          const dateField = aggregate.replace("Latest ", "");
          fldNms.push(
            `(select "${sqlsanitize(field)}" from ${schema}"${sqlsanitize(
              table
            )}" where ${dateField}=(select max(${dateField}) from ${schema}"${sqlsanitize(
              table
            )}" where "${sqlsanitize(ref)}"=a.id${
              where ? ` and ${where}` : ""
            }) and "${sqlsanitize(ref)}"=a.id) ${sqlsanitize(fldnm)}`
          );
        } else if (subselect)
          fldNms.push(
            `(select ${sqlsanitize(aggregate)}(${
              field ? `"${sqlsanitize(field)}"` : "*"
            }) from ${schema}"${sqlsanitize(table)}" where ${sqlsanitize(
              ref
            )} in (select "${subselect.field}" from ${schema}"${
              subselect.table.name
            }" where "${subselect.whereField}"=a.id)) ${sqlsanitize(fldnm)}`
          );
        else
          fldNms.push(
            `(select ${sqlsanitize(aggregate)}(${
              field ? `"${sqlsanitize(field)}"` : "*"
            }) from ${schema}"${sqlsanitize(table)}" where "${sqlsanitize(
              ref
            )}"=a.id${where ? ` and ${where}` : ""}) ${sqlsanitize(fldnm)}`
          );
      }
    );

    let whereObj = {};
    if (opts.where) {
      Object.keys(opts.where).forEach((k) => {
        if (k === "_fts") whereObj[k] = { table: "a", ...opts.where[k] };
        else whereObj[`a."${k}"`] = opts.where[k];
      });
    }
    const { where, values } = mkWhere(whereObj, db.isSQLite);
    const selectopts = {
      limit: opts.limit,
      orderBy:
        opts.orderBy &amp;&amp;
        (opts.orderBy.distance ? opts.orderBy : "a." + opts.orderBy),
      orderDesc: opts.orderDesc,
      offset: opts.offset,
    };

    const sql = `SELECT ${fldNms.join()} FROM ${schema}"${sqlsanitize(
      this.name
    )}" a ${joinq} ${where}  ${mkSelectOptions(selectopts)}`;
    return { sql, values };
  }

  /**
   * @param {object} [opts = {}]
   * @returns {Promise&lt;object[]>}
   */
  async getJoinedRows(opts = {}) {
    const fields = await this.getFields();

    const { sql, values } = await this.getJoinedQuery(opts);
    const res = await db.query(sql, values);

    return apply_calculated_fields(res.rows, fields);
  }
}

/**
 * Table contract
 * @type {{variables: {name: ((function(*=): *)|*)}, methods: {updateRow: ((function(*=): *)|*), get_history: ((function(*=): *)|*), tryUpdateRow: ((function(*=): *)|*), deleteRows: ((function(*=): *)|*), update: ((function(*=): *)|*), getRows: ((function(*=): *)|*), getRow: ((function(*=): *)|*), delete: ((function(*=): *)|*), get_parent_relations: ((function(*=): *)|*), get_child_relations: ((function(*=): *)|*), tryInsertRow: ((function(*=): *)|*), getFields: ((function(*=): *)|*), insertRow: ((function(*=): *)|*), toggleBool: ((function(*=): *)|*), getJoinedRows: ((function(*=): *)|*), countRows: ((function(*=): *)|*), distinctValues: ((function(*=): *)|*), sql_name: ((function(*=): *)|*), import_csv_file: ((function(*=): *)|*)}, static_methods: {find: ((function(*=): *)|*), create_from_csv: ((function(*=): *)|*), findOne: ((function(*=): *)|*), find_with_external: ((function(*=): *)|*), create: ((function(*=): *)|*)}, constructs: {name: ((function(*=): *)|*)}}}
 */
Table.contract = {
  constructs: { name: is.str },
  variables: { name: is.str },
  methods: {
    delete: is.fun([], is.promise(is.eq(undefined))),
    update: is.fun(is.obj(), is.promise(is.eq(undefined))),
    deleteRows: is.fun(is.obj(), is.promise(is.eq(undefined))),
    getRow: is.fun(is.maybe(is.obj()), is.promise(is.maybe(is.obj()))),
    getRows: is.fun(is.maybe(is.obj()), is.promise(is.array(is.obj()))),
    countRows: is.fun(is.maybe(is.obj()), is.promise(is.posint)),
    updateRow: is.fun([is.obj(), is.any], is.promise(is.eq(undefined))),
    toggleBool: is.fun([is.any, is.str], is.promise(is.eq(undefined))),
    insertRow: is.fun(is.obj(), is.promise(is.any)),
    get_history: is.fun(is.posint, is.promise(is.array(is.obj()))),
    distinctValues: is.fun(is.str, is.promise(is.array(is.any))),
    tryInsertRow: is.fun(
      [is.obj(), is.maybe(is.posint)],
      is.promise(is.or(is.obj({ error: is.str }), is.obj({ success: is.any })))
    ),
    tryUpdateRow: is.fun(
      [is.obj(), is.any, is.maybe(is.posint)],
      is.promise(
        is.or(is.obj({ error: is.str }), is.obj({ success: is.eq(true) }))
      )
    ),
    sql_name: is.getter(is.str),
    getFields: is.fun([], is.promise(is.array(is.class("Field")))),
    get_parent_relations: is.fun(
      [],
      is.promise(
        is.obj({
          parent_relations: is.array(
            is.obj({
              key_field: is.class("Field"),
              table: is.class("Table"),
            })
          ),
          parent_field_list: is.array(is.str),
        })
      )
    ),
    get_child_relations: is.fun(
      [],
      is.promise(
        is.obj({
          child_relations: is.array(
            is.obj({
              key_field: is.class("Field"),
              table: is.class("Table"),
            })
          ),
          child_field_list: is.array(is.str),
        })
      )
    ),
    import_csv_file: is.fun(
      is.str,
      is.promise(is.or(is.obj({ success: is.str }), is.obj({ error: is.str })))
    ),
    getJoinedRows: is.fun(
      is.maybe(is_table_query),
      is.promise(is.array(is.obj({})))
    ),
  },
  static_methods: {
    find: is.fun(
      [is.maybe(is.obj()), is.maybe(is.obj())],
      is.promise(is.array(is.class("Table")))
    ),
    find_with_external: is.fun(
      [is.maybe(is.obj()), is.maybe(is.obj())],
      is.promise(
        is.array(is.or(is.class("Table"), is.obj({ external: is.eq(true) })))
      )
    ),
    findOne: is.fun(
      is.or(is.obj(), is.str, is.posint),
      is.maybe(is.or(is.class("Table"), is.obj({ external: is.eq(true) })))
    ),
    create: is.fun(is.str, is.promise(is.class("Table"))),
    create_from_csv: is.fun(
      [is.str, is.str],
      is.promise(
        is.or(
          is.obj({ success: is.str, table: is.class("Table") }),
          is.obj({ error: is.str })
        )
      )
    ),
    //update: is.fun([is.posint, is.obj({})], is.promise(is.eq(undefined)))
  },
};
module.exports = Table;
</code></pre>
        </article>
    </section>




            </div>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

<script src="scripts/search.js"> </script>

</body>
</html>
